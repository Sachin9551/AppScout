<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Privacy Scout</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background-color: #e5e7eb;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            transition: width 0.5s ease-in-out;
        }
        .accordion-item {
            transition: all 0.3s ease;
        }
        .accordion-item[open] summary ~ * {
            animation: fadeIn 0.3s ease-in;
        }
        /* Enhanced UI: Add subtle gradients and shadows */
        .card {
            background: linear-gradient(to bottom right, white, #f9fafb);
            border: 1px solid #e5e7eb;
        }
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #1f2937;
                color: #f3f4f6;
            }
            .card {
                background: linear-gradient(to bottom right, #374151, #1f2937);
                border: 1px solid #4b5563;
            }
            header {
                background: linear-gradient(to right, #0f766e, #065f46);
            }
            footer {
                background-color: #111827;
            }
            .text-gray-600 {
                color: #d1d5db;
            }
            .text-gray-700 {
                color: #e5e7eb;
            }
            .text-gray-800 {
                color: #f3f4f6;
            }
            .bg-gray-50 {
                background-color: #374151;
            }
            .bg-gray-800 {
                background-color: #1f2937;
            }
            .border-gray-300 {
                border-color: #4b5563;
            }
            .text-gray-500 {
                color: #9ca3af;
            }
            .progress-bar {
                background-color: #4b5563;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans antialiased dark:bg-gray-800">
    <header class="bg-gradient-to-r from-teal-600 to-teal-800 text-white p-6 sticky top-0 z-10 shadow-md">
        <div class="max-w-5xl mx-auto flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold tracking-tight">App Privacy Scout</h1>
                <p class="text-sm opacity-80">Check apps for privacy risks before you use them</p>
            </div>
            <div class="hidden md:block space-x-4">
                <a href="#tips" class="text-sm hover:underline">Privacy Tips</a>
                <a href="#history" class="text-sm hover:underline">Scan History</a>
            </div>
        </div>
    </header>

    <main class="max-w-5xl mx-auto p-6 space-y-8">
        <section id="home" class="card rounded-lg shadow-lg p-8">
            <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-3">Stay Safe with Apps</h2>
            <p class="text-gray-600 dark:text-gray-400 mb-6">
                Upload an app’s privacy policy file or paste its URL to analyze risky permissions and data practices. Get clear, actionable advice to protect your privacy.
            </p>
            <div class="p-8 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-center transition-all hover:border-teal-400 dark:hover:border-teal-300">
                <input type="file" id="fileInput" class="hidden" accept=".txt,.pdf" onchange="scanPolicy()">
                <label for="fileInput" class="cursor-pointer text-teal-600 dark:text-teal-400 font-medium hover:text-teal-700 dark:hover:text-teal-300 transition">
                    <svg class="w-12 h-12 mx-auto mb-2 text-teal-500 dark:text-teal-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 4v12m-8-4h8"></path></svg>
                    Click to upload or drag policy file here
                </label>
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-3">Or paste a privacy policy URL:</p>
                <div class="mt-4 flex items-center gap-2 max-w-md mx-auto">
                    <input type="text" id="urlInput" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200" placeholder="https://app.com/privacy">
                    <button onclick="scanUrl()" class="bg-teal-600 text-white px-6 py-3 rounded-lg hover:bg-teal-700 transition">Scan URL</button>
                </div>
            </div>
        </section>

        <section id="results" class="hidden card rounded-lg shadow-lg p-8 fade-in">
            <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-4 flex items-center">
                <svg class="w-6 h-6 mr-2 text-teal-600 dark:text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                Privacy Scan Results
            </h2>
            <div id="scanReport" class="text-gray-700 dark:text-gray-300"></div>
            <div class="mt-6 flex space-x-4">
                <button onclick="suggestAlternatives()" class="bg-teal-600 text-white px-6 py-3 rounded-lg hover:bg-teal-700 transition hidden" id="suggestButton">
                    Find Safer Alternatives
                </button>
                <button onclick="exportResults()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition hidden" id="exportButton">
                    Export Results
                </button>
            </div>
        </section>

        <section id="history" class="card rounded-lg shadow-lg p-8">
            <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-4 flex items-center">
                <svg class="w-6 h-6 mr-2 text-teal-600 dark:text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                Scan History
            </h2>
            <div id="scanHistory" class="space-y-4"></div>
        </section>

        <section id="tips" class="card rounded-lg shadow-lg p-8">
            <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-4">App Privacy Tips</h2>
            <ul class="list-disc pl-6 text-gray-600 dark:text-gray-400 space-y-2">
                <li>Always review app permissions before installing.</li>
                <li>Avoid apps that share data with third parties unnecessarily.</li>
                <li>Disable unused permissions in your device settings for better control.</li>
                <li>Regularly check app privacy policies for updates.</li>
            </ul>
        </section>
    </main>

    <footer class="bg-gray-800 text-white text-center p-4 mt-8">
        <p class="text-sm">© 2025 App Privacy Scout. All rights reserved.</p>
    </footer>

    <script>
        function calculateRandomRisk() {
            const riskPatterns = [
                { term: 'third-party sharing', weight: 5, desc: 'Shares data with external companies', risk: 'High' },
                { term: 'location tracking', weight: 3, desc: 'Tracks your location', risk: 'Medium' },
                { term: 'camera access', weight: 4, desc: 'Requests camera access', risk: 'High' },
                { term: 'microphone access', weight: 4, desc: 'Requests microphone access', risk: 'High' },
                { term: 'contacts access', weight: 4, desc: 'Accesses your contacts', risk: 'High' },
                { term: 'personal data', weight: 3, desc: 'Collects sensitive personal data', risk: 'Medium' },
                { term: 'analytics', weight: 2, desc: 'Uses analytics to track behavior', risk: 'Medium' },
                { term: 'clipboard access', weight: 3, desc: 'Accesses clipboard data', risk: 'Medium' },
                { term: 'advertising', weight: 2, desc: 'Collects data for ads', risk: 'Medium' }
            ];

            const numRisks = Math.floor(Math.random() * 5);
            const risks = [];
            for (let i = 0; i < numRisks; i++) {
                const randomIndex = Math.floor(Math.random() * riskPatterns.length);
                if (!risks.includes(riskPatterns[randomIndex])) {
                    risks.push(riskPatterns[randomIndex]);
                }
            }

            let score = 0;
            risks.forEach(r => {
                score += r.weight;
            });

            let riskLevel = 'Low';
            let colorClass = 'text-green-600';
            let progressColor = 'bg-green-500';
            let progressWidth = '20%';

            if (score >= 10) {
                riskLevel = 'Critical';
                colorClass = 'text-red-800';
                progressColor = 'bg-red-800';
                progressWidth = '100%';
            } else if (score >= 8) {
                riskLevel = 'High';
                colorClass = 'text-red-600';
                progressColor = 'bg-red-500';
                progressWidth = '90%';
            } else if (score >= 4) {
                riskLevel = 'Medium';
                colorClass = 'text-yellow-600';
                progressColor = 'bg-yellow-500';
                progressWidth = '60%';
            }

            return { riskLevel, colorClass, progressColor, progressWidth, score, risks };
        }

        let currentRiskData = null; // To store current scan data for export

        function scanPolicy() {
            const fileInput = document.getElementById('fileInput');
            const scanReport = document.getElementById('scanReport');
            const resultsSection = document.getElementById('results');
            const suggestButton = document.getElementById('suggestButton');
            const exportButton = document.getElementById('exportButton');

            if (fileInput.files.length === 0) return;

            const file = fileInput.files[0];
            const reader = new FileReader();

            reader.onload = function(e) {
                const riskData = calculateRandomRisk();
                currentRiskData = { ...riskData, input: file.name, type: 'file' };

                resultsSection.classList.remove('hidden');
                if (riskData.risks.length > 0) {
                    scanReport.innerHTML = `
                        <p class="${riskData.colorClass} font-medium">Privacy Risk: ${riskData.riskLevel} (Score: ${riskData.score}/10)</p>
                        <div class="progress-bar mt-2">
                            <div class="${riskData.progressColor} progress-fill" style="width: ${riskData.progressWidth}"></div>
                        </div>
                        <p class="mt-3">Risky practices detected:</p>
                        <ul class="list-disc pl-5">
                            ${riskData.risks.map(r => `<li>${r.desc} (${r.risk})</li>`).join('')}
                        </ul>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-3">
                            Recommendation: ${riskData.riskLevel !== 'Low' ? (riskData.riskLevel === 'Critical' ? 'Avoid this app or consult a privacy expert before use.' : 'Consider safer alternatives or disable risky permissions.') : 'App appears relatively safe, but stay vigilant.'}
                        </p>
                    `;
                    suggestButton.classList.remove('hidden');
                    exportButton.classList.remove('hidden');
                } else {
                    scanReport.innerHTML = `
                        <p class="${riskData.colorClass} font-medium">Privacy Risk: Low (Score: 0/10)</p>
                        <div class="progress-bar mt-2">
                            <div class="${riskData.progressColor} progress-fill" style="width: 20%"></div>
                        </div>
                        <p>No major privacy concerns detected. App appears safe.</p>
                    `;
                    suggestButton.classList.add('hidden');
                    exportButton.classList.remove('hidden');
                }
            };

            reader.readAsText(file);
        }

        async function scanUrl() {
            const url = document.getElementById('urlInput').value.trim();
            const scanReport = document.getElementById('scanReport');
            const resultsSection = document.getElementById('results');
            const suggestButton = document.getElementById('suggestButton');
            const exportButton = document.getElementById('exportButton');
            const scanHistory = document.getElementById('scanHistory');

            if (!url) return;

            try {
                const riskData = calculateRandomRisk();
                currentRiskData = { ...riskData, input: url, type: 'url' };

                // Save to history
                const history = JSON.parse(localStorage.getItem('scanHistory') || '[]');
                const timestamp = new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' });
                history.push({ url, riskLevel: riskData.riskLevel, score: riskData.score, timestamp });
                localStorage.setItem('scanHistory', JSON.stringify(history.slice(-10))); // Limit to last 10 entries

                // Render history
                renderHistory();

                resultsSection.classList.remove('hidden');
                if (riskData.risks.length > 0) {
                    scanReport.innerHTML = `
                        <p class="${riskData.colorClass} font-medium">Privacy Risk: ${riskData.riskLevel} (Score: ${riskData.score}/10)</p>
                        <div class="progress-bar mt-2">
                            <div class="${riskData.progressColor} progress-fill" style="width: ${riskData.progressWidth}"></div>
                        </div>
                        <p class="mt-3">Risky practices detected:</p>
                        <ul class="list-disc pl-5">
                            ${riskData.risks.map(r => `<li>${r.desc} (${r.risk})</li>`).join('')}
                        </ul>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-3">
                            Recommendation: ${riskData.riskLevel !== 'Low' ? (riskData.riskLevel === 'Critical' ? 'Avoid this app or consult a privacy expert before use.' : 'Consider safer alternatives or disable risky permissions.') : 'App appears relatively safe, but stay vigilant.'}
                        </p>
                    `;
                    suggestButton.classList.remove('hidden');
                    exportButton.classList.remove('hidden');
                } else {
                    scanReport.innerHTML = `
                        <p class="${riskData.colorClass} font-medium">Privacy Risk: Low (Score: 0/10)</p>
                        <div class="progress-bar mt-2">
                            <div class="${riskData.progressColor} progress-fill" style="width: 20%"></div>
                        </div>
                        <p>No major privacy concerns detected. App appears safe.</p>
                    `;
                    suggestButton.classList.add('hidden');
                    exportButton.classList.remove('hidden');
                }
            } catch (error) {
                scanReport.innerHTML = `
                    <p class="text-red-600 dark:text-red-400 font-medium">Error scanning URL</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Privacy policy could not be fetched. Please try another URL or upload a file.</p>
                `;
                resultsSection.classList.remove('hidden');
                suggestButton.classList.add('hidden');
                exportButton.classList.add('hidden');
            }
        }

        function renderHistory() {
            const scanHistory = document.getElementById('scanHistory');
            const history = JSON.parse(localStorage.getItem('scanHistory') || '[]');

            scanHistory.innerHTML = '';
            if (history.length === 0) {
                scanHistory.innerHTML = '<p class="text-gray-500 dark:text-gray-400">No scan history available.</p>';
                return;
            }

            history.forEach((entry, index) => {
                scanHistory.innerHTML += `
                    <details class="accordion-item border rounded-lg p-4 bg-gray-50 dark:bg-gray-700">
                        <summary class="cursor-pointer font-medium text-gray-700 dark:text-gray-300 flex justify-between items-center">
                            ${entry.url}
                            <span class="${entry.riskLevel === 'Low' ? 'text-green-600 dark:text-green-400' : entry.riskLevel === 'Medium' ? 'text-yellow-600 dark:text-yellow-400' : entry.riskLevel === 'High' ? 'text-red-600 dark:text-red-400' : 'text-red-800 dark:text-red-500'}">
                                ${entry.riskLevel} (Score: ${entry.score}/10)
                            </span>
                        </summary>
                        <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">Scanned at: ${entry.timestamp}</p>
                    </details>
                `;
            });
        }

        function suggestAlternatives() {
            alert('Finding safer app alternatives... (Feature to be implemented)');
        }

        function exportResults() {
            if (!currentRiskData) return;

            const { riskLevel, score, risks, input, type } = currentRiskData;
            let content = `App Privacy Scout Scan Results\n\n`;
            content += `Input: ${input} (${type === 'url' ? 'URL' : 'File'})\n`;
            content += `Privacy Risk: ${riskLevel} (Score: ${score}/10)\n\n`;

            if (risks.length > 0) {
                content += `Risky practices detected:\n`;
                risks.forEach(r => {
                    content += `- ${r.desc} (${r.risk})\n`;
                });
                content += `\nRecommendation: ${riskLevel !== 'Low' ? (riskLevel === 'Critical' ? 'Avoid this app or consult a privacy expert before use.' : 'Consider safer alternatives or disable risky permissions.') : 'App appears relatively safe, but stay vigilant.'}\n`;
            } else {
                content += `No major privacy concerns detected. App appears safe.\n`;
            }

            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'privacy_scan_results.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        const dropZone = document.querySelector('.border-dashed');
        dropZone.addEventListener('dragover', e => e.preventDefault());
        dropZone.addEventListener('drop', e => {
            e.preventDefault();
            document.getElementById('fileInput').files = e.dataTransfer.files;
            scanPolicy();
        });

        // Load history on page load
        window.onload = renderHistory;
    </script>
</body>
</html>
